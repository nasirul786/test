<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sheets to JSON | Glass Converter</title>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 md:p-8">
    <div class="w-full max-w-4xl">
        <!-- Header -->
        <motion.div 
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            class="text-center mb-8"
        >
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">Sheets to JSON</h1>
            <p class="text-xl text-white/80">Convert Google Sheets to beautiful JSON with glassmorphism effects</p>
        </motion.div>

        <!-- Main Card -->
        <motion.div 
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.5, delay: 0.1 }}
            class="glass-card p-6 md:p-8 mb-8 fade-in"
        >
            <div class="mb-6">
                <label for="sheet-url" class="block text-sm font-medium text-white/80 mb-2">Google Sheet URL or ID</label>
                <div class="flex rounded-lg overflow-hidden">
                    <span class="inline-flex items-center px-4 py-3 bg-white/10 text-white/80 text-sm border-r border-white/10">
                        https://docs.google.com/spreadsheets/d/
                    </span>
                    <input 
                        type="text" 
                        id="sheet-url" 
                        class="glass-input flex-1 px-4 py-3 text-white placeholder-white/50 focus:ring-0 focus:border-white/30 text-sm"
                        placeholder="1KBU2nmrmrf1LvRFn6yFRYwFC2nUMiiS7RzPRiMNFhRM"
                        value="1KBU2nmrmrf1LvRFn6yFRYwFC2nUMiiS7RzPRiMNFhRM"
                    >
                </div>
            </div>

            <div class="flex justify-center">
                <button 
                    id="convert-btn"
                    class="glass-button flex items-center px-6 py-3 rounded-lg text-white font-medium pulse"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                    </svg>
                    Convert to JSON
                </button>
            </div>

            <div id="status-message" class="mt-4 text-center text-sm hidden"></div>
        </motion.div>

        <!-- Loading State -->
        <motion.div 
            id="loading"
            initial={{ opacity: 0 }}
            class="glass-card p-6 text-center mb-8 hidden"
        >
            <div class="flex justify-center items-center space-x-3">
                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-white">Loading data from Google Sheets...</span>
            </div>
        </motion.div>

        <!-- Result Card -->
        <motion.div 
            id="result-container"
            initial={{ opacity: 0 }}
            class="glass-card p-6 hidden"
        >
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">JSON Output</h2>
                <button 
                    id="copy-btn"
                    class="glass-button flex items-center px-4 py-2 rounded-lg text-white text-sm"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                    </svg>
                    Copy
                </button>
            </div>
            <pre id="output" class="bg-black/30 text-white p-4 rounded-lg overflow-x-auto text-sm max-h-96"></pre>
        </motion.div>
    </div>

    <footer class="mt-8 text-center text-white/60 text-sm">
        <p>Works with public Google Sheets. Make sure your sheet is published to the web.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sheetUrlInput = document.getElementById('sheet-url');
            const convertBtn = document.getElementById('convert-btn');
            const output = document.getElementById('output');
            const resultContainer = document.getElementById('result-container');
            const loading = document.getElementById('loading');
            const copyBtn = document.getElementById('copy-btn');
            const statusMessage = document.getElementById('status-message');

            // Parse CSV properly (handles quotes, commas, new lines)
            function parseCSV(csvText) {
                const rows = [];
                let currentRow = [];
                let currentValue = '';
                let insideQuotes = false;

                for (let i = 0; i < csvText.length; i++) {
                    const char = csvText[i];
                    const nextChar = csvText[i + 1];

                    if (char === '"' && insideQuotes && nextChar === '"') {
                        // Double quote inside quoted string
                        currentValue += '"';
                        i++;
                    } else if (char === '"') {
                        insideQuotes = !insideQuotes;
                    } else if (char === ',' && !insideQuotes) {
                        currentRow.push(currentValue.trim());
                        currentValue = '';
                    } else if ((char === '\n' || char === '\r') && !insideQuotes) {
                        if (currentValue || currentRow.length) {
                            currentRow.push(currentValue.trim());
                            rows.push(currentRow);
                        }
                        currentRow = [];
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }

                if (currentValue || currentRow.length) {
                    currentRow.push(currentValue.trim());
                    rows.push(currentRow);
                }

                return rows;
            }

            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = `text-center text-sm ${type === 'success' ? 'text-green-300' : 'text-red-300'}`;
                statusMessage.classList.remove('hidden');
                
                // Animate status message
                motion.animate(statusMessage, 
                    { opacity: [0, 1], y: [-10, 0] },
                    { duration: 0.3 }
                );
            }

            function hideStatus() {
                motion.animate(statusMessage, 
                    { opacity: [1, 0], y: [0, -10] },
                    { 
                        duration: 0.3,
                        onComplete: () => statusMessage.classList.add('hidden')
                    }
                );
            }

            async function fetchGoogleSheetCSV(sheetId) {
                // Clear previous results
                output.textContent = '';
                resultContainer.classList.add('hidden');
                loading.classList.remove('hidden');
                hideStatus();

                // Animate loading in
                motion.animate(loading, 
                    { opacity: [0, 1], y: [-10, 0] },
                    { duration: 0.3 }
                );

                // Construct the URL
                let url;
                if (sheetId.includes('http')) {
                    // If it's a full URL, extract the ID
                    const match = sheetId.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                    if (match && match[1]) {
                        sheetId = match[1];
                    }
                }

                url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();

                    const rows = parseCSV(csvText);
                    if (rows.length === 0) {
                        throw new Error('No data found in the sheet');
                    }

                    const headers = rows.shift();
                    if (!headers || headers.length === 0) {
                        throw new Error('No headers found in the sheet');
                    }

                    const data = rows
                        .filter(row => row.length > 1 && row[0].trim() !== "")
                        .map(row => {
                            let obj = {};
                            headers.forEach((header, index) => {
                                let value = row[index] || "";

                                // Parse JSON in 'extra' column
                                if (header.trim().toLowerCase() === "extra" && value.startsWith("{")) {
                                    try {
                                        value = JSON.parse(value);
                                    } catch (e) {
                                        console.error("Invalid JSON in extra:", e);
                                    }
                                }

                                obj[header.trim()] = value;
                            });
                            return obj;
                        });

                    // Animate loading out and result in
                    motion.animate(loading, 
                        { opacity: [1, 0], y: [0, -10] },
                        { 
                            duration: 0.3,
                            onComplete: () => {
                                loading.classList.add('hidden');
                                output.textContent = JSON.stringify(data, null, 2);
                                resultContainer.classList.remove('hidden');
                                motion.animate(resultContainer, 
                                    { opacity: [0, 1], y: [-10, 0] },
                                    { duration: 0.5 }
                                );
                            }
                        }
                    );

                    showStatus('Data loaded successfully!', 'success');
                } catch (error) {
                    console.error("Error fetching or parsing CSV:", error);
                    motion.animate(loading, 
                        { opacity: [1, 0], y: [0, -10] },
                        { 
                            duration: 0.3,
                            onComplete: () => loading.classList.add('hidden')
                        }
                    );
                    showStatus(`Error: ${error.message}`, 'error');
                }
            }

            // Event listeners
            convertBtn.addEventListener('click', function() {
                const sheetId = sheetUrlInput.value.trim();
                if (!sheetId) {
                    showStatus('Please enter a Google Sheet URL or ID', 'error');
                    return;
                }
                fetchGoogleSheetCSV(sheetId);
            });

            copyBtn.addEventListener('click', function() {
                navigator.clipboard.writeText(output.textContent)
                    .then(() => {
                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            Copied!
                        `;
                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy text: ', err);
                        showStatus('Failed to copy text to clipboard', 'error');
                    });
            });

            // Allow pressing Enter in the input field
            sheetUrlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    convertBtn.click();
                }
            });
        });
    </script>
</body>
</html>
